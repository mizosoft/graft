name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24'

      - name: Build all modules
        run: |
          go build ./graft/...
          go build ./infra/...
          go build ./kvstore/...
          go build ./msgq/...
          go build ./dlock/...
          go build ./testutil/...
          go build ./benchmarks/...
          go build ./badger/...

      - name: Run tests
        run: |
          go test ./graft/...
          go test ./infra/...
          go test ./kvstore/...
          go test ./msgq/...
          go test ./dlock/...
          go test ./testutil/...
          go test ./benchmarks/...
          go test ./badger/...

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24'

      - name: Run go vet
        run: |
          go vet ./graft/...
          go vet ./infra/...
          go vet ./kvstore/...
          go vet ./msgq/...
          go vet ./dlock/...
          go vet ./testutil/...
          go vet ./benchmarks/...
          go vet ./badger/...
